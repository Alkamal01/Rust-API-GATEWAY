version: '3.8'

services:
  rusta-gateway:
    build:
      context: .
      dockerfile: Dockerfile
    image: rusta:latest
    container_name: rusta-gateway
    ports:
      - "5900:5900"
    volumes:
      # Mount config.json from host to container
      - ./config.json:/app/config.json:ro
    environment:
      - RUST_LOG=info
      - RUSTA_HOST=0.0.0.0
      - RUSTA_PORT=5900
    restart: unless-stopped
    networks:
      - rusta-network

  rusta-ui:
    build:
      # Use repository root as build context so the UI Dockerfile can access
      # workspace-level files (Cargo.toml) and the full workspace source.
      context: .
      dockerfile: crates/rusta-ui/Dockerfile
    image: rusta-ui:latest
    container_name: rusta-ui
    ports:
      - "8080:80"
    restart: unless-stopped
    networks:
      - rusta-network
  # Optional: WebSocket test backend
  # ws-backend:
  #   build:
  #     context: ./examples/websocket_routing
  #     dockerfile: Dockerfile
  #   container_name: ws-backend
  #   ports:
  #     - "3000:3000"
  #   networks:
  #     - rusta-network

networks:
  rusta-network:
    driver: bridge
